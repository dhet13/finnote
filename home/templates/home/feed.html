{% extends 'home/base.html' %}

{% block title %}í™ˆ í”¼ë“œ - FinTech SNS{% endblock %}

{% block content %}
<div style="display: none;" id="auth-data" data-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}"></div>


<!-- íƒ­ ì˜ì—­ -->
<div style="border-bottom: 1px solid #eff3f4;">
    <div style="display: flex;">
        <button class="feed-tab active-tab" onclick="switchTab('foryou')" style="flex: 1; padding: 16px; background: none; border: none; font-weight: bold; font-size: 15px; cursor: pointer; position: relative; color: #0f1419;">
            For you
        </button>
        <button class="feed-tab" onclick="switchTab('following')" style="flex: 1; padding: 16px; background: none; border: none; font-weight: bold; font-size: 15px; cursor: pointer; position: relative; color: #536471;">
            Following
        </button>
    </div>
</div>

<!-- í¬ìŠ¤íŠ¸ ì‘ì„± ì˜ì—­ -->
<form method="POST" action="{% url 'home:create_simple_post' %}" enctype="multipart/form-data" style="border-bottom: 1px solid #eff3f4; padding: 15px;" onsubmit="submitPost(event)">
    {% csrf_token %}
    <div style="display: flex; align-items: flex-start; gap: 12px;">
        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ placeholder -->
        <div style="width: 40px; height: 40px; background: #1d9bf0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
            U
        </div>
        
        <!-- ì…ë ¥ ì˜ì—­ -->
        <div style="flex: 1;">
            <textarea name="content" id="post-content" placeholder="What's happening?" 
                style="width: 100%; min-height: 50px; font-size: 18px; color: #0f1419; border: none; outline: none; resize: none; padding: 12px 0; border-bottom: 1px solid #eff3f4; margin-bottom: 12px; background: transparent; font-family: inherit;" 
                oninput="togglePostButton()"></textarea>

            <input type="file" id="image-input" name="image" accept="image/*" style="display: none;" onchange="previewImage(this)">
            
            <div id="image-preview" style="display: none; margin-bottom: 12px; position: relative;">
                <div style="width: 100%; aspect-ratio: 16/9; overflow: hidden; border-radius: 12px; border: 1px solid #eff3f4; position: relative;">
                    <img id="preview-img" style="width: 100%; height: 100%; object-fit: cover;">
                    <button type="button" onclick="removeImage()" style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px;">âœ•</button>
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 16px;">
                    <button type="button" id="trading-journal-btn" onclick="openTradingJournal()" style="display: inline-block; padding: 8px; border-radius: 50%; transition: background-color 0.2s; margin-right: 12px; background: none; border: none; cursor: pointer;" 
                    onmouseover="this.style.backgroundColor='rgba(29, 155, 240, 0.1)'" 
                    onmouseout="this.style.backgroundColor='transparent'"
                    title="ë§¤ë§¤ì¼ì§€ ì‘ì„±">
                        <span class="material-symbols-outlined" style="color: #1d9bf0; font-size: 20px;">assessment</span>
                    </button>

                    <button type="button" id="image-upload-btn" onclick="document.getElementById('image-input').click()" style="display: inline-block; padding: 8px; border-radius: 50%; transition: background-color 0.2s; background: none; border: none; cursor: pointer;"
                    onmouseover="this.style.backgroundColor='rgba(29, 155, 240, 0.1)'" 
                    onmouseout="this.style.backgroundColor='transparent'"
                    title="ì´ë¯¸ì§€ ì²¨ë¶€">
                        <span class="material-symbols-outlined" style="color: #1d9bf0; font-size: 20px;">image</span>
                    </button>
                </div>
                
                <button type="submit" id="post-button" style="background: #1d9bf0; color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; opacity: 0.5;" disabled>
                    Post
                </button>
            </div>
        </div>
    </div>
</form>



<!-- í•„í„° ë²„íŠ¼ -->
<div style="padding: 12px 16px; border-bottom: 1px solid #eff3f4; background: #f7f9fa;">
    <div style="display: flex; gap: 8px; align-items: center;">
        <button onclick="toggleFilter('ë§¤ë§¤ì¼ì§€')" id="filter-ë§¤ë§¤ì¼ì§€" style="background: #ffffff; color: #0f1419; border: 1px solid #eff3f4; padding: 6px 12px; border-radius: 20px; font-size: 14px; cursor: pointer;">
            #ë§¤ë§¤ì¼ì§€
        </button>
        <button onclick="toggleFilter('ì£¼ì‹')" id="filter-ì£¼ì‹" style="background: #ffffff; color: #0f1419; border: 1px solid #eff3f4; padding: 6px 12px; border-radius: 20px; font-size: 14px; cursor: pointer;">
            #ì£¼ì‹
        </button>
        <button onclick="toggleFilter('ë¶€ë™ì‚°')" id="filter-ë¶€ë™ì‚°" style="background: #ffffff; color: #0f1419; border: 1px solid #eff3f4; padding: 6px 12px; border-radius: 20px; font-size: 14px; cursor: pointer;">
            #ë¶€ë™ì‚°
        </button>
        
        <!-- ì¶”ê°€ íƒœê·¸ë“¤ì´ ì—¬ê¸° ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        <div id="custom-tags-container" style="display: flex; gap: 8px;"></div>
        
        <!-- íƒœê·¸ ì¶”ê°€ ì…ë ¥ì°½ -->
        <div style="display: flex; gap: 4px; align-items: center;">
            <input type="text" id="tag-input" placeholder="íƒœê·¸ ì¶”ê°€" maxlength="10" 
                style="width: 80px; padding: 4px 8px; border: 1px solid #eff3f4; border-radius: 12px; font-size: 13px;"
                onkeypress="handleTagInput(event)">
            <button onclick="addCustomTag()" id="add-tag-btn" 
                style="background: #1d9bf0; color: white; border: none; padding: 4px 8px; border-radius: 12px; font-size: 12px; cursor: pointer;">
                ì¶”ê°€
            </button>
        </div>
    </div>
</div>


<!-- í¬ìŠ¤íŠ¸ í”¼ë“œ -->
<div id="posts-container">
    {% if posts %}
        {% for post in posts %}
        <div class="post-card" data-post-type="{{ post.asset_class }}">
            <div class="post-header">
                <span class="post-username">{{ post.user.username }}</span>
                <span class="post-time">{{ post.created_at|timesince }} ì „</span>
            </div>
            
            <div class="post-meta">
                <span style="color: #1d9bf0; font-weight: 500;">{{ post.get_asset_class_display }}</span> â€¢ 
            </div>
            
            <div class="post-content">
                {{ post.content }}
            </div>
                        
            {% if post.image %}
            <div style="margin: 10px 0;">
                <div style="width: 100%; aspect-ratio: 16/9; overflow: hidden; border-radius: 12px; border: 1px solid #eff3f4; cursor: pointer;" onclick="openImageModal('{{ post.image.url }}')">
                    <img src="{{ post.image.url }}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" 
                        style="width: 100%; height: 100%; object-fit: cover;">
                </div>
            </div>
            {% elif post.screenshot_url %}
            <div style="margin: 10px 0; cursor: pointer;" onclick="openImageModal('{{ post.screenshot_url }}')">
                <img src="{{ post.screenshot_url }}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" 
                    style="max-width: 100%; border-radius: 12px; border: 1px solid #eff3f4;">
            </div>
            {% endif %}
            
            <div class="action-buttons">
                <div class="action-btn" data-action="comments" data-post-id="{{ post.id }}">
                    <span class="material-symbols-outlined">chat_bubble</span>
                    <span>{{ post.comments.count }}</span>
                </div>
                
                <div class="action-btn" data-action="like" data-post-id="{{ post.id }}" id="like-btn-{{ post.id }}">
                    <span class="material-symbols-outlined" id="like-icon-{{ post.id }}">favorite_border</span>
                    <span id="likes-count-{{ post.id }}">{{ post.likes.count }}</span>
                </div>
                
                <div class="action-btn" data-action="bookmark" data-post-id="{{ post.id }}">
                    <span class="material-symbols-outlined">bookmark_border</span>
                    <span>{{ post.bookmarks.count }}</span>
                </div>
                
                <div class="action-btn" data-action="share" data-post-id="{{ post.id }}" id="share-btn-{{ post.id }}">
                    <span class="material-symbols-outlined" id="share-icon-{{ post.id }}">share</span>
                    <span id="shares-count-{{ post.id }}">{{ post.shares.count }}</span>
                </div>
            </div>
            <!-- ëŒ“ê¸€ ì„¹ì…˜ ì¶”ê°€ -->
            <div class="comments-section" id="comments-{{ post.id }}" style="display: none; margin-top: 15px; border-top: 1px solid #eff3f4; padding-top: 15px;">
                <!-- ëŒ“ê¸€ ì‘ì„± ì˜ì—­ -->
                <div class="comment-write" style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <input type="text" id="comment-input-{{ post.id }}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                           style="flex: 1; padding: 8px 12px; border: 1px solid #eff3f4; border-radius: 20px; outline: none;">
                    <button data-action="submit-comment" data-post-id="{{ post.id }}" 
                            style="padding: 8px 16px; background: #1d9bf0; color: white; border: none; border-radius: 20px; cursor: pointer;">
                        ì‘ì„±
                    </button>
                </div>
                
                <!-- ëŒ“ê¸€ ëª©ë¡ -->
                <div class="comments-list" id="comments-list-{{ post.id }}">
                    <!-- ëŒ“ê¸€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <h3>í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>
                <a href="/admin/">ê´€ë¦¬ì í˜ì´ì§€</a>ì—ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.
            </p>
        </div>
    {% endif %}
</div>

<!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
<div id="image-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9);" onclick="closeImageModal()">
    <span style="position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;" onclick="closeImageModal()">&times;</span>
    <img id="modal-image" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90%; max-height: 90%;">
</div>

<script>
// ë§¤ë§¤ì¼ì§€ ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™” ë ˆì´ì–´
const TradingJournalInterface = {
    // ì„¤ì • (íŒ€ì›ê³¼ í•©ì˜ëœ ë¶€ë¶„)
    config: {
        modalUrl: '/journals/compose/?modal=1',
        modalWidth: 800,
        modalHeight: 600
    },
    
    // ëª¨ë‹¬ ì—´ê¸°
    openModal: function(callback) {
        this.resultCallback = callback;
        
        // ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ìƒì„±
        const overlay = document.createElement('div');
        overlay.id = 'trading-modal-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        `;
        
        // ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ
        const modal = document.createElement('div');
        modal.style.cssText = `
            background: white;
            border-radius: 8px;
            width: ${this.config.modalWidth}px;
            height: ${this.config.modalHeight}px;
            max-width: 95vw;
            max-height: 95vh;
            overflow: hidden;
            position: relative;
        `;
        
        // iframeìœ¼ë¡œ ë§¤ë§¤ì¼ì§€ ë¡œë“œ
        const iframe = document.createElement('iframe');
        iframe.src = this.config.modalUrl;
        iframe.style.cssText = `
            width: 100%;
            height: 100%;
            border: none;
        `;
        
        // ë‹«ê¸° ë²„íŠ¼
        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '&times;';
        closeBtn.style.cssText = `
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: 1;
            color: #666;
        `;
        closeBtn.onclick = () => this.closeModal();
        
        modal.appendChild(iframe);
        modal.appendChild(closeBtn);
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        
        // ESC í‚¤ë¡œ ë‹«ê¸°
        this.keyHandler = (e) => {
            if (e.key === 'Escape') this.closeModal();
        };
        document.addEventListener('keydown', this.keyHandler);
        
        console.log('ë§¤ë§¤ì¼ì§€ ëª¨ë‹¬ ì—´ë¦¼');
    },
    
    // ëª¨ë‹¬ ë‹«ê¸°
    closeModal: function() {
        const overlay = document.getElementById('trading-modal-overlay');
        if (overlay) {
            overlay.remove();
        }
        if (this.keyHandler) {
            document.removeEventListener('keydown', this.keyHandler);
        }
        console.log('ë§¤ë§¤ì¼ì§€ ëª¨ë‹¬ ë‹«í˜');
    },
    
    // ì™„ë£Œ ê²°ê³¼ ì²˜ë¦¬ (íŒ€ì› ì‹œìŠ¤í…œì—ì„œ í˜¸ì¶œ)
    onComplete: function(result) {
        if (this.resultCallback) {
            this.resultCallback(result);
        }
        this.closeModal();
    },
    
    // íŒ€ì›ê³¼ì˜ ì¸í„°í˜ì´ìŠ¤ (postMessage ìˆ˜ì‹ )
    setupMessageListener: function() {
        window.addEventListener('message', (event) => {
            if (event.data.type === 'trading-journal-complete') {
                this.onComplete(event.data.payload);
            }
        });
    }
};
// í¬ìŠ¤íŠ¸ ìƒíƒœ ê´€ë¦¬
const PostStateManager = {
    currentState: 'none', // 'none', 'image', 'trading'
    
    setState: function(newState) {
        this.currentState = newState;
        this.updateUI();
    },
    
    updateUI: function() {
        const tradingBtn = document.getElementById('trading-journal-btn');
        const imageBtn = document.getElementById('image-upload-btn');
        const postBtn = document.getElementById('post-button');
        
        if (this.currentState === 'trading') {
            // ë§¤ë§¤ì¼ì§€ ì„ íƒë¨
            tradingBtn.style.opacity = '1';
            imageBtn.style.opacity = '0.3';
            imageBtn.style.pointerEvents = 'none';
            this.showPrivacyToggle();
        } else if (this.currentState === 'image') {
            // ì´ë¯¸ì§€ ì„ íƒë¨  
            imageBtn.style.opacity = '1';
            tradingBtn.style.opacity = '0.3';
            tradingBtn.style.pointerEvents = 'none';
            this.hidePrivacyToggle();
        } else {
            // ì•„ë¬´ê²ƒë„ ì„ íƒ ì•ˆë¨
            tradingBtn.style.opacity = '1';
            tradingBtn.style.pointerEvents = 'auto';
            imageBtn.style.opacity = '1';
            imageBtn.style.pointerEvents = 'auto';
            this.hidePrivacyToggle();
        }
        
        this.updatePostButton();
    },
    
    updatePostButton: function() {
        const textarea = document.getElementById('post-content');
        const postBtn = document.getElementById('post-button');
        const hasContent = textarea.value.trim().length > 0;
        const hasAttachment = this.currentState !== 'none';
        
        if (hasContent || hasAttachment) {
            postBtn.disabled = false;
            postBtn.style.opacity = '1';
        } else {
            postBtn.disabled = true;
            postBtn.style.opacity = '0.5';
        }
    },
    
    showPrivacyToggle: function() {
        let toggle = document.getElementById('privacy-toggle');
        if (!toggle) {
            toggle = document.createElement('div');
            toggle.id = 'privacy-toggle';
            toggle.innerHTML = `
                <label style="display: flex; align-items: center; gap: 8px; margin-top: 10px; font-size: 14px;">
                    <input type="checkbox" id="private-post" style="margin: 0;">
                    <span>ë‚˜ë§Œë³´ê¸°</span>
                </label>
            `;
            const form = document.querySelector('form[action*="create_simple_post"]');
            form.insertBefore(toggle, form.lastElementChild);
        }
        toggle.style.display = 'block';
    },
    
    hidePrivacyToggle: function() {
        const toggle = document.getElementById('privacy-toggle');
        if (toggle) {
            toggle.style.display = 'none';
        }
    }
};

// ë§¤ë§¤ì¼ì§€ ì—´ê¸° í•¨ìˆ˜
function openTradingJournal() {
    TradingJournalInterface.openModal(function(result) {
        // ë§¤ë§¤ì¼ì§€ ì™„ë£Œì‹œ ì½œë°±
        console.log('ë§¤ë§¤ì¼ì§€ ì™„ë£Œ:', result);
        PostStateManager.setState('trading');
        // TODO: ë§¤ë§¤ì¼ì§€ ì¹´ë“œ í‘œì‹œ
    });
}
// í˜ì´ì§€ ë¡œë“œì‹œ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
document.addEventListener('DOMContentLoaded', function() {
    TradingJournalInterface.setupMessageListener();
});

// íƒ­ ì „í™˜ ê¸°ëŠ¥
function switchTab(tabType) {
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.feed-tab').forEach(tab => {
        tab.classList.remove('active-tab');
        tab.style.color = '#536471';
    });
    
    // í´ë¦­ëœ íƒ­ í™œì„±í™”
    event.target.classList.add('active-tab');
    event.target.style.color = '#0f1419';
    
    // ì—¬ê¸°ì— ì‹¤ì œ í•„í„°ë§ ë¡œì§ ì¶”ê°€ ì˜ˆì •
    console.log('Tab switched to:', tabType);
}

// í¬ìŠ¤íŠ¸ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
function togglePostButton() {
    PostStateManager.updatePostButton(); 
}

// ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
function previewImage(input) {
    const preview = document.getElementById('image-preview');
    const img = document.getElementById('preview-img');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            img.src = e.target.result;
            preview.style.display = 'block';
            PostStateManager.setState('image');
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}

// ì´ë¯¸ì§€ ì œê±°
function removeImage() {
    document.getElementById('image-input').value = '';
    document.getElementById('image-preview').style.display = 'none';
    PostStateManager.setState('none');
}

// í•„í„° ìƒíƒœ ê´€ë¦¬
let activeFilters = [];
let customTags = [];
const MAX_CUSTOM_TAGS = 3;

function toggleFilter(tagName) {
    const button = document.getElementById(`filter-${tagName}`);
    
    if (activeFilters.includes(tagName)) {
        activeFilters = activeFilters.filter(f => f !== tagName);
        button.style.background = '#ffffff';
        button.style.color = '#0f1419';
    } else {
        activeFilters.push(tagName);
        button.style.background = '#1d9bf0';
        button.style.color = '#ffffff';
    }
    
    applyFilters();
}
function handleTagInput(event) {
    if (event.key === 'Enter') {
        event.preventDefault();
        addCustomTag();
    }
}

function addCustomTag() {
    const input = document.getElementById('tag-input');
    const tagName = input.value.trim();
    
    if (!tagName) return;
    if (customTags.length >= MAX_CUSTOM_TAGS) {
        alert('ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    if (customTags.includes(tagName) || ['ë§¤ë§¤ì¼ì§€', 'ì£¼ì‹', 'ë¶€ë™ì‚°'].includes(tagName)) {
        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íƒœê·¸ì…ë‹ˆë‹¤.');
        return;
    }
    
    customTags.push(tagName);
    renderCustomTags();
    input.value = '';
}

function renderCustomTags() {
    const container = document.getElementById('custom-tags-container');
    container.innerHTML = '';
    
    customTags.forEach(tagName => {
        const tagButton = document.createElement('button');
        tagButton.innerHTML = `#${tagName} <span onclick="removeCustomTag('${tagName}')" style="margin-left: 4px;">Ã—</span>`;
        tagButton.id = `filter-${tagName}`;
        tagButton.onclick = () => toggleFilter(tagName);
        tagButton.style.cssText = 'background: #ffffff; color: #0f1419; border: 1px solid #eff3f4; padding: 6px 12px; border-radius: 20px; font-size: 14px; cursor: pointer;';
        container.appendChild(tagButton);
    });
}

function removeCustomTag(tagName) {
    customTags = customTags.filter(tag => tag !== tagName);
    renderCustomTags();
    
    const index = activeFilters.indexOf(tagName);
    if (index > -1) {
        activeFilters.splice(index, 1);
        applyFilters();
    }
}

function applyFilters() {
    const posts = document.querySelectorAll('.post-card');
    posts.forEach(post => {
        if (activeFilters.length === 0) {
            post.style.display = 'block';
        } else {
            post.style.display = 'none';  // ì„ì‹œë¡œ ìˆ¨ê¹€ (ë‚˜ì¤‘ì— ì‹¤ì œ íƒœê·¸ ë§¤ì¹­ êµ¬í˜„)
        }
    });
}
// ì´ë¯¸ì§€ ëª¨ë‹¬ ì—´ê¸°
function openImageModal(imageSrc) {
    const modal = document.getElementById('image-modal');
    const modalImg = document.getElementById('modal-image');
    
    modal.style.display = 'block';
    modalImg.src = imageSrc;
}

// ì´ë¯¸ì§€ ëª¨ë‹¬ ë‹«ê¸°
function closeImageModal() {
    document.getElementById('image-modal').style.display = 'none';
}
// AJAX í¬ìŠ¤íŠ¸ ì œì¶œ
function submitPost(event) {
    event.preventDefault(); // ê¸°ë³¸ form submit ë§‰ê¸°
    
    const form = event.target;
    const formData = new FormData(form);
    
    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // ì„±ê³µ ì‹œ í”¼ë“œì— ìƒˆ í¬ìŠ¤íŠ¸ ì¶”ê°€
            addNewPostToFeed(data.post);
            
            // í¼ ì´ˆê¸°í™”
            form.reset();
            document.getElementById('post-button').disabled = true;
            document.getElementById('post-button').style.opacity = '0.5';
            document.getElementById('image-preview').style.display = 'none';
        } else {
            alert('í¬ìŠ¤íŠ¸ ì‘ì„± ì‹¤íŒ¨: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('í¬ìŠ¤íŠ¸ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

function addNewPostToFeed(postData) {
    const postsContainer = document.getElementById('posts-container');
    
    // ìƒˆ í¬ìŠ¤íŠ¸ HTML ìƒì„±
    const newPostHTML = `
        <div class="post-card" data-post-type="${postData.asset_class}">
            <div class="post-header">
                <span class="post-username">${postData.username}</span>
                <span class="post-time">ë°©ê¸ˆ ì „</span>
            </div>
            
            <div class="post-meta">
                <span style="color: #1d9bf0; font-weight: 500;">${postData.asset_class_display}</span> â€¢ 
            </div>
            
            <div class="post-content">
                ${postData.content}
            </div>
            
            ${postData.image_url ? `
            <div style="margin: 10px 0;">
                <div style="width: 100%; aspect-ratio: 16/9; overflow: hidden; border-radius: 12px; border: 1px solid #eff3f4; cursor: pointer;" onclick="openImageModal('${postData.image_url}')">
                    <img src="${postData.image_url}" alt="ì²¨ë¶€ ì´ë¯¸ì§€" 
                        style="width: 100%; height: 100%; object-fit: cover;">
                </div>
            </div>
            ` : ''}
            
            <div class="action-buttons">
                <div class="action-btn">
                    <span class="material-symbols-outlined">chat_bubble</span>
                    <span>0</span>
                </div>
                
                <div class="action-btn">
                    <span class="material-symbols-outlined">favorite</span>
                    <span>0</span>
                </div>
                
                <div class="action-btn">
                    <span class="material-symbols-outlined">bookmark</span>
                    <span>0</span>
                </div>
                
                <div class="action-btn">
                    <span class="material-symbols-outlined">share</span>
                    <span>0</span>
                </div>
            </div>
        </div>
    `;
    
    // í”¼ë“œ ë§¨ ìœ„ì— ìƒˆ í¬ìŠ¤íŠ¸ ì¶”ê°€
    postsContainer.insertAdjacentHTML('afterbegin', newPostHTML);
}
// ìºëŸ¬ì…€ ë³€ìˆ˜
let currentSlide = 0;
const totalSlides = 3; // ì´ 3ê°œ ìŠ¬ë¼ì´ë“œ (9ê°œ ë‰´ìŠ¤ Ã· 3ê°œ = 3ê°œ)

// ìŠ¬ë¼ì´ë“œ í‘œì‹œ í•¨ìˆ˜
function showSlide(slideIndex) {
    const newsItems = document.querySelectorAll('.news-item');
    const dots = document.querySelectorAll('.dot');
    
    // ëª¨ë“  ë‰´ìŠ¤ ì•„ì´í…œ ìˆ¨ê¸°ê¸°
    newsItems.forEach(item => {
        item.classList.add('hidden');
    });
    
    // í•´ë‹¹ ìŠ¬ë¼ì´ë“œì˜ ë‰´ìŠ¤ ì•„ì´í…œë“¤ ë³´ì´ê¸° (3ê°œì”©)
    for (let i = slideIndex * 3; i < (slideIndex + 1) * 3; i++) {
        if (newsItems[i]) {
            newsItems[i].classList.remove('hidden');
        }
    }
    
    // ëª¨ë“  ì  ë¹„í™œì„±í™”
    dots.forEach(dot => {
        dot.style.background = '#ccc';
    });
    
    // í˜„ì¬ ì  í™œì„±í™”
    if (dots[slideIndex]) {
        dots[slideIndex].style.background = '#1d9bf0';
    }
    
    currentSlide = slideIndex;
}

// ì´ì „ ìŠ¬ë¼ì´ë“œ
function prevSlide() {
    const newSlide = currentSlide === 0 ? totalSlides - 1 : currentSlide - 1;
    showSlide(newSlide);
}

// ë‹¤ìŒ ìŠ¬ë¼ì´ë“œ
function nextSlide() {
    const newSlide = currentSlide === totalSlides - 1 ? 0 : currentSlide + 1;
    showSlide(newSlide);
}

// ìë™ ìŠ¬ë¼ì´ë“œ (5ì´ˆë§ˆë‹¤)
let autoSlideInterval = setInterval(nextSlide, 10000);

// í˜¸ë²„ì‹œ ìë™ ìŠ¬ë¼ì´ë“œ ì •ì§€
const carousel = document.querySelector('.news-carousel');
if (carousel) {
    carousel.addEventListener('mouseenter', () => {
        clearInterval(autoSlideInterval);
    });
    
    carousel.addEventListener('mouseleave', () => {
        autoSlideInterval = setInterval(nextSlide, 10000);
    });
}
document.addEventListener('DOMContentLoaded', function() {
    showSlide(0);
});
// CSRF í† í° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ 
function getCSRFToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}

// ì‚¬ìš©ì ì¸ì¦ í™•ì¸ í•¨ìˆ˜
function isUserAuthenticated() {
    const authData = document.getElementById('auth-data');
    return authData.getAttribute('data-authenticated') === 'true';
}

// ì¢‹ì•„ìš” í† ê¸€ í•¨ìˆ˜
function toggleLike(postId) {
    if (!isUserAuthenticated()) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }

    const likeBtn = document.getElementById('like-btn-' + postId);
    const likeIcon = document.getElementById('like-icon-' + postId);
    const likesCount = document.getElementById('likes-count-' + postId);
    
    const isCurrentlyLiked = likeIcon.textContent === 'favorite';
    
    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    likeIcon.textContent = isCurrentlyLiked ? 'favorite_border' : 'favorite';
    likeIcon.style.color = isCurrentlyLiked ? '#536471' : '#e91e63';
    
    const currentCount = parseInt(likesCount.textContent);
    likesCount.textContent = isCurrentlyLiked ? currentCount - 1 : currentCount + 1;
    
    // ì„œë²„ ìš”ì²­
    fetch('/home/post/' + postId + '/like/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),
        },
    })
    .then(response => response.json())
    .then(data => {
        likeIcon.textContent = data.liked ? 'favorite' : 'favorite_border';
        likeIcon.style.color = data.liked ? '#e91e63' : '#536471';
        likesCount.textContent = data.likes_count;
    })
    .catch(error => {
        console.error('ì˜¤ë¥˜:', error);
        likeIcon.textContent = isCurrentlyLiked ? 'favorite' : 'favorite_border';
        likeIcon.style.color = isCurrentlyLiked ? '#e91e63' : '#536471';
        likesCount.textContent = currentCount;
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}
// ë¶ë§ˆí¬ í† ê¸€ í•¨ìˆ˜
function toggleBookmark(postId) {
    if (!isUserAuthenticated()) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }

    const bookmarkBtn = document.querySelector('[data-post-id="' + postId + '"][data-action="bookmark"]');
    const bookmarkIcon = bookmarkBtn.querySelector('.material-symbols-outlined');
    const bookmarksCount = bookmarkBtn.querySelector('span:last-child');
    
    const isCurrentlyBookmarked = bookmarkIcon.textContent === 'bookmark';
    
    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    bookmarkIcon.textContent = isCurrentlyBookmarked ? 'bookmark_border' : 'bookmark';
    bookmarkIcon.style.color = isCurrentlyBookmarked ? '#536471' : '#1d9bf0';
    
    const currentCount = parseInt(bookmarksCount.textContent);
    bookmarksCount.textContent = isCurrentlyBookmarked ? currentCount - 1 : currentCount + 1;
    
    // ì„œë²„ ìš”ì²­
    fetch('/home/post/' + postId + '/bookmark/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),
        },
    })
    .then(response => response.json())
    .then(data => {
        bookmarkIcon.textContent = data.bookmarked ? 'bookmark' : 'bookmark_border';
        bookmarkIcon.style.color = data.bookmarked ? '#1d9bf0' : '#536471';
        bookmarksCount.textContent = data.bookmarks_count;
    })
    .catch(error => {
        console.error('ì˜¤ë¥˜:', error);
        bookmarkIcon.textContent = isCurrentlyBookmarked ? 'bookmark' : 'bookmark_border';
        bookmarkIcon.style.color = isCurrentlyBookmarked ? '#1d9bf0' : '#536471';
        bookmarksCount.textContent = currentCount;
        alert('ë¶ë§ˆí¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}   
// ëŒ“ê¸€ í† ê¸€ í•¨ìˆ˜ (ëŒ“ê¸€ ì„¹ì…˜ ì—´ê¸°/ë‹«ê¸°)
function toggleComments(postId) {
    const commentsSection = document.getElementById('comments-' + postId);
    
    if (commentsSection.style.display === 'none' || commentsSection.style.display === '') {
        commentsSection.style.display = 'block';
        loadComments(postId);
    } else {
        commentsSection.style.display = 'none';
    }
}

// ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ
function loadComments(postId) {
    fetch('/home/post/' + postId + '/comments/')
    .then(response => response.json())
    .then(data => {
        displayComments(postId, data.comments);
    })
    .catch(error => {
        console.error('ëŒ“ê¸€ ë¡œë“œ ì˜¤ë¥˜:', error);
    });
}

// ëŒ“ê¸€ ì œì¶œ
function submitComment(postId) {
    if (!isUserAuthenticated()) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    const commentInput = document.getElementById('comment-input-' + postId);
    const content = commentInput.value.trim();
    
    if (!content) {
        alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    fetch('/home/post/' + postId + '/comment/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),
        },
        body: JSON.stringify({
            content: content
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.comment_id) {
            commentInput.value = '';
            const commentsCountElement = document.querySelector(`[data-post-id="${postId}"][data-action="comments"] span:last-child`);
            commentsCountElement.textContent = data.comments_count;
            loadComments(postId);
        } else {
            alert(data.error || 'ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    })
    .catch(error => {
        console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        alert('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ëŒ“ê¸€ í‘œì‹œ
function displayComments(postId, comments) {
    const commentsList = document.getElementById('comments-list-' + postId);
    
    if (comments.length === 0) {
        commentsList.innerHTML = '<div style="color: #536471; text-align: center; padding: 20px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    
    let commentsHTML = '';
    comments.forEach(comment => {
        commentsHTML += `
            <div class="comment" style="margin-bottom: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: bold; color: #0f1419;">${comment.username}</span>
                    <span style="color: #536471; font-size: 12px;">${comment.created_at}</span>
                </div>
                <div style="color: #0f1419; line-height: 1.4;">${comment.content}</div>
            </div>
        `;
    });
    
    commentsList.innerHTML = commentsHTML;
}
// ê³µìœ  ê¸°ëŠ¥
function sharePost(postId) {
    if (!isUserAuthenticated()) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    // ë¨¼ì € ê³µìœ  ì¹´ìš´íŠ¸ ì¦ê°€ (ì‚¬ìš©ìë‹¹ 1íšŒ)
    toggleShareCount(postId);
    
    // ê·¸ ë‹¤ìŒ ê³µìœ  ë„êµ¬ ì œê³µ
    const postUrl = window.location.origin + '/post/' + postId + '/';
    showShareOptions(postUrl);
}

// ê³µìœ  ì¹´ìš´íŠ¸ í† ê¸€ (ì‚¬ìš©ìë‹¹ 1íšŒ)
function toggleShareCount(postId) {
    fetch('/post/' + postId + '/share/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),
        },
    })
    .then(response => response.json())
    .then(data => {
        const sharesCount = document.getElementById('shares-count-' + postId);
        sharesCount.textContent = data.shares_count;
        
        // ê³µìœ  ìƒíƒœì— ë”°ë¼ ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½
        const shareIcon = document.getElementById('share-icon-' + postId);
        shareIcon.style.color = data.shared ? '#1d9bf0' : '#536471';
    })
    .catch(error => {
        console.error('ê³µìœ  ì¹´ìš´íŠ¸ ì˜¤ë¥˜:', error);
    });
}

// ê³µìœ  ë„êµ¬ ëª¨ë‹¬ í‘œì‹œ
function showShareOptions(postUrl) {
    const shareOptions = [
        { name: 'KakaoTalk', icon: 'ğŸ’¬', color: '#FEE500', textColor: '#3C1E1E', action: () => shareToKakao(postUrl) },
        { name: 'Instagram', icon: 'ğŸ“·', color: 'linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%)', textColor: '#ffffff', action: () => shareToInstagram(postUrl) },
        { name: 'Twitter', icon: 'ğŸ¦', color: '#1DA1F2', textColor: '#ffffff', action: () => shareToTwitter(postUrl) },
        { name: 'URL ë³µì‚¬', icon: 'ğŸ”—', color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', textColor: '#ffffff', action: () => copyToClipboard(postUrl) }
    ];
    
    let optionsHtml = `
    <div style="padding: 32px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 20px;">
        <div style="text-align: center; margin-bottom: 24px;">
            <div style="font-size: 24px; margin-bottom: 8px;">âœ¨</div>
            <h3 style="margin: 0; font-size: 20px; font-weight: 700; color: #2d3748; letter-spacing: -0.5px;">ê³µìœ í•˜ê¸°</h3>
            <p style="margin: 8px 0 0 0; color: #718096; font-size: 14px;">ì¹œêµ¬ë“¤ê³¼ ì´ í¬ìŠ¤íŠ¸ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!</p>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
    `;
    
    shareOptions.forEach((option, index) => {
        optionsHtml += `
            <button onclick="handleShareOption(${index})" 
                style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 20px 16px;
                    background: ${option.color};
                    color: ${option.textColor};
                    border: none;
                    border-radius: 16px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 600;
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    position: relative;
                    overflow: hidden;
                "
                onmouseover="
                    this.style.transform='translateY(-2px) scale(1.02)';
                    this.style.boxShadow='0 8px 25px rgba(0,0,0,0.25)';
                "
                onmouseout="
                    this.style.transform='translateY(0) scale(1)';
                    this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';
                "
                onmousedown="this.style.transform='translateY(-1px) scale(0.98)'"
                onmouseup="this.style.transform='translateY(-2px) scale(1.02)'"
            >
                <div style="font-size: 24px; margin-bottom: 8px;">${option.icon}</div>
                <div style="font-size: 13px; font-weight: 600;">${option.name}</div>
            </button>
        `;
    });
    
    optionsHtml += `
        </div>
        <button onclick="closeShareModal()" 
            style="
                width: 100%;
                padding: 14px;
                background: rgba(255,255,255,0.9);
                color: #4a5568;
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 12px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
            "
            onmouseover="
                this.style.background='rgba(255,255,255,1)';
                this.style.transform='translateY(-1px)';
            "
            onmouseout="
                this.style.background='rgba(255,255,255,0.9)';
                this.style.transform='translateY(0)';
            "
        >
            ë‹«ê¸°
        </button>
    </div>
    `;
    
    // ê³µìœ  ëª¨ë‹¬ ìƒì„±
    const shareModal = document.createElement('div');
    shareModal.id = 'share-modal';
    shareModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    `;
    
    const shareContent = document.createElement('div');
    shareContent.style.cssText = `
        background: transparent;
        border-radius: 20px;
        max-width: 360px;
        width: 90%;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
    `;
    shareContent.innerHTML = optionsHtml;
    
    shareModal.appendChild(shareContent);
    
    // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes modalSlideIn {
            from { 
                transform: scale(0.7) translateY(20px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        @keyframes modalSlideOut {
            from { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
            to { 
                transform: scale(0.7) translateY(-20px);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(shareModal);
    
    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì €ì¥
    window.currentShareOptions = shareOptions;
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸° (ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
    shareModal.addEventListener('click', function(e) {
        if (e.target === shareModal) {
            closeShareModalWithAnimation();
        }
    });
    
    // ESC í‚¤ë¡œ ë‹«ê¸°
    const handleEsc = (e) => {
        if (e.key === 'Escape') {
            closeShareModalWithAnimation();
            document.removeEventListener('keydown', handleEsc);
        }
    };
    document.addEventListener('keydown', handleEsc);
}

// ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜ ëª¨ë‹¬ ë‹«ê¸°
function closeShareModalWithAnimation() {
    const modal = document.getElementById('share-modal');
    const content = modal?.querySelector('div');
    
    if (modal && content) {
        modal.style.animation = 'modalFadeIn 0.2s cubic-bezier(0.4, 0, 0.2, 1) reverse';
        content.style.animation = 'modalSlideOut 0.2s cubic-bezier(0.4, 0, 0.2, 1)';
        
        setTimeout(() => {
            closeShareModal();
        }, 200);
    }
}

// ê¸°ì¡´ closeShareModal í•¨ìˆ˜ ìˆ˜ì •
function closeShareModal() {
    const modal = document.getElementById('share-modal');
    if (modal) {
        modal.remove();
    }
    window.currentShareOptions = null;
}

// ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
function shareToKakao(postUrl) {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
        // ëª¨ë°”ì¼ì—ì„œëŠ” ì¹´ì¹´ì˜¤í†¡ URL ìŠ¤í‚´ ì‚¬ìš©
        const kakaoUrl = `kakaotalk://send?text=${encodeURIComponent('FinTech SNSì—ì„œ í¥ë¯¸ë¡œìš´ í¬ìŠ¤íŠ¸ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤! ' + postUrl)}`;
        window.location.href = kakaoUrl;
        
        // ì¹´ì¹´ì˜¤í†¡ ì•±ì´ ì—†ì„ ê²½ìš° ëŒ€ì²´ ë°©ë²•
        setTimeout(() => {
            copyToClipboard(postUrl);
            alert('ì¹´ì¹´ì˜¤í†¡ ì•±ìœ¼ë¡œ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì´ ë³µì‚¬ë˜ì—ˆìœ¼ë‹ˆ ì¹´ì¹´ì˜¤í†¡ì—ì„œ ì§ì ‘ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
        }, 1000);
    } else {
        // ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” URL ë³µì‚¬ í›„ ì•ˆë‚´
        copyToClipboard(postUrl);
        alert('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ì—ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì—¬ ê³µìœ í•˜ì„¸ìš”.');
    }
    
    closeShareModal();
}

// Instagram ê³µìœ 
function shareToInstagram(postUrl) {
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
        // ëª¨ë°”ì¼ì—ì„œëŠ” Instagram ì•±ìœ¼ë¡œ ì—°ê²° ì‹œë„
        const instagramUrl = `instagram://library?AssetPath=${encodeURIComponent(postUrl)}`;
        window.location.href = instagramUrl;
        
        setTimeout(() => {
            copyToClipboard(postUrl);
            alert('Instagram ì•±ìœ¼ë¡œ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì´ ë³µì‚¬ë˜ì—ˆìœ¼ë‹ˆ Instagramì—ì„œ ì§ì ‘ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
        }, 1000);
    } else {
        copyToClipboard(postUrl);
        alert('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. Instagram ì›¹ì‚¬ì´íŠ¸ë‚˜ ì•±ì—ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì—¬ ê³µìœ í•˜ì„¸ìš”.');
    }
    
    closeShareModal();
}

// Twitter ê³µìœ 
function shareToTwitter(postUrl) {
    const twitterUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(postUrl)}&text=${encodeURIComponent('FinTech SNSì—ì„œ í¥ë¯¸ë¡œìš´ í¬ìŠ¤íŠ¸ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!')}`;
    window.open(twitterUrl, '_blank');
    closeShareModal();
}

// URL í´ë¦½ë³´ë“œ ë³µì‚¬
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('URLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        closeShareModal();
    }).catch(err => {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
}

// ê³µìœ  ì˜µì…˜ ì²˜ë¦¬
function handleShareOption(index) {
    if (window.currentShareOptions && window.currentShareOptions[index]) {
        window.currentShareOptions[index].action();
    }
}

// ê³µìœ  ëª¨ë‹¬ ë‹«ê¸°
function closeShareModal() {
    const modal = document.getElementById('share-modal');
    if (modal) {
        modal.remove();
    }
    window.currentShareOptions = null;
}
// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
document.addEventListener('DOMContentLoaded', function() {
    showSlide(0);  // ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€
    
    // ëª¨ë“  action ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    document.querySelectorAll('.action-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            const postId = this.getAttribute('data-post-id');
            
            if (action === 'like') {
                toggleLike(postId);
            } else if (action === 'comments') {
                toggleComments(postId);

            } else if (action === 'bookmark') {
                toggleBookmark(postId);

            } else if (action === 'share') {
                sharePost(postId);
            }
        });
    });
    // ëŒ“ê¸€ ì‘ì„± ë²„íŠ¼ë“¤
    document.querySelectorAll('[data-action="submit-comment"]').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const postId = this.getAttribute('data-post-id');
            submitComment(postId);
        });
    });
});
</script>
{% endblock %}