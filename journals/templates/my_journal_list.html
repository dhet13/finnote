{% extends "base.html" %}

{% block feed %}
<style>
    .journal-container { padding: 20px; max-width: 800px; margin: auto; }
    .tabs { display: flex; border-bottom: 2px solid #f0f0f0; margin-bottom: 24px; }
    .tab-item { padding: 12px 20px; cursor: pointer; font-size: 16px; font-weight: 500; color: #888; position: relative; border-bottom: 2px solid transparent; }
    .tab-item.active { color: #111; border-bottom-color: #111; }
    .search-bar { display: flex; gap: 8px; margin-bottom: 24px; }
    .search-bar input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
    .search-bar button { padding: 10px 16px; background-color: #333; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .journal-card { background-color: #fff; border: 1px solid #eee; border-radius: 8px; padding: 20px; margin-bottom: 16px; text-decoration: none; color: inherit; display: block;}
    .journal-card:hover { border-color: #ccc; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .card-title { font-size: 1.5rem; font-weight: bold; }
    .card-meta { font-size: 0.9rem; color: #666; }
    .card-memo { color: #555; margin-bottom: 16px; }
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr 2fr; gap: 12px; }
    .stat-box { background-color: #f9f9f9; border-radius: 4px; padding: 12px; text-align: center; }
    .stat-label { font-size: 0.8rem; color: #777; margin-bottom: 4px; }
    .stat-value { font-size: 1.2rem; font-weight: 500; }
    .pnl-box { background-color: #f0f0f0; }
    .pnl-positive { color: #28a745 !important; }
    .pnl-negative { color: #dc3545 !important; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
</style>

<div class="journal-container">
    <h1>매매일지</h1>

    <div class="tabs">
        <div class="tab-item active" data-tab="stocks">내 투자 종목 (주식)</div>
        <div class="tab-item" data-tab="realty">내 투자 부동산</div>
    </div>

    <div id="tab-stocks" class="tab-content active">
        <form method="get" class="search-bar">
            <input type="text" name="q" placeholder="티커/종목명/메모 검색" value="{{ request.GET.q }}">
            <button type="submit">검색</button>
        </form>

        <div class="post-list">
            {% for summary in stock_summaries %}
                <a href="{% url 'journals:stock_summary_detail' summary.ticker_symbol__ticker_symbol %}" class="journal-card">
                    <div class="card-header">
                        <span class="card-title">{{ summary.ticker_symbol__stock_name }} ({{ summary.ticker_symbol__ticker_symbol }})</span>
                        {# No last trade info here, as per simplified wireframe #}
                    </div>
                    {# No memo here, as per simplified wireframe #}
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">평균 매수가</div>
                            <div class="stat-value">{{ summary.overall_avg_buy_price|floatformat:2|default:"-" }}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">평균 매도가</div>
                            <div class="stat-value">{{ summary.overall_avg_sell_price|floatformat:2|default:"-" }}</div>
                        </div>
                        <div class="stat-box pnl-box">
                            <div class="stat-label">손익(매도)</div>
                            <div class="stat-value {% if summary.overall_return_rate > 0 %}pnl-positive{% elif summary.overall_return_rate < 0 %}pnl-negative{% endif %}">
                                {% if summary.overall_return_rate is not None %}
                                    {{ summary.overall_return_rate|floatformat:2 }}%
                                {% else %}
                                    —
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
            {% empty %}
                <p>작성한 주식 매매일지가 없습니다.</p>
            {% endfor %}
        </div>
    </div>

    <div id="tab-realty" class="tab-content">
        <div class="post-list">
            {% for deal in re_deals %}
                {# The anchor tag for the detail page will be added later #}
                <a href="#" class="journal-card">
                    <p>부동산 매매일지: {{ deal.property_info.building_name }}</p>
                </a>
            {% empty %}
                <p>작성한 부동산 매매일지가 없습니다.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.tab-item');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            tabs.forEach(item => item.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            this.classList.add('active');
            document.getElementById('tab-' + this.dataset.tab).classList.add('active');
        });
    });
});
</script>

{% endblock %}